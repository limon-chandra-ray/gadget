{% extends 'user/layouts/index.html' %}
{% block title %}{{title}}{% endblock title %}

{% block userbody %}
<style>
    .review-card{
        padding: 7px 0px
    }
    .review-header{
        display: flex;
        border-bottom: 1px solid gray;
        padding-bottom: 10px;
    }
    .review-header-left{
        flex: 1 1 auto;
    }
    .review-header-right{
        flex: 0 0 auto;
        display: flex;
        align-items: center;
    }
    .average-rating{
        display: flex;
        column-gap: 7px;
    }
    .average-rating svg{
        font-size: 20px;
    }
    .button-groups{
        padding:26px
    }
    .button-groups a{
        border: none;
        font-size: 20px;
        padding: 15px 33px;
        border-radius: 5px;
        background: #a0a0a0;
        color: rgb(10, 10, 10);
    }
    .button-groups a:first-child, .button-groups a:hover{
        background: #3b6404;
        color: white;
    }
    .rating_active{
        color:orange
    }
    .slide-item-list li {
        width:40% !important
    }
    .slide-item-list li :hover{
        border: 1px solid #302c2c;
    }
    /* WebKit-based browsers (Chrome, Safari) */
    ::-webkit-scrollbar {
    width: 10px; /* vertical scroll bar width */
    height: 10px; /* horizontal scroll bar height */
    }

    /* Mozilla Firefox */
    ::-moz-scrollbar {
    width: 10px; /* vertical scroll bar width */
    height: 10px; /* horizontal scroll bar height */
    }
</style>
    <div class="row page-titles">
        <ol class="breadcrumb">
            <li class="breadcrumb-item active"><a href="javascript:void(0)">Home</a></li>
            <li class="breadcrumb-item"><a href="javascript:void(0)">{{product.name}}</a></li>
        </ol>
    </div>
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-xl-6 col-lg-6 col-xxl-6 col-12">
                            <div class="row">
                                <div class="col-lg-9 col-12">
                                    <div class="tab-content">
                                        <div role="tabpanel" class="tab-pane fade show active float-end" style="height:324px" id="first">
                                            <img class="img-fluid" src="{{product.image.url}}" style="height:100%" alt="">
                                        </div>
                                        {% for image in product_image %}
                                        <div role="tabpanel" class="tab-pane fade float-end" style="height:324px" id="tab{{image.id}}">
                                            <img class="img-fluid" src="{{image.image.url}}" style="height:100%" alt="">
                                        </div>
                                        {% endfor %}
                                        
                                    </div>
                                </div>
                                <div class="col-lg-3 col-12">
                                    <div class="tab-slide-content new-arrival-product mb-4 mb-xl-0 overflow-auto" style="height:324px;">
                                        <!-- Nav tabs -->
                                        <ul class="nav slide-item-list mt-3 d-flex flex-column align-items-end" style="row-gap: 10px;" role="tablist">
                                            <li role="presentation">
                                                <a href="#first" role="tab" data-bs-toggle="tab"  data-bs-target="#first"><img class="img-fluid" src="{{product.image.url}}" alt="" width="50"></a>
                                            </li>
                                            {% for image in product_image %}
                                                <li role="presentation">
                                                    <a href="#tab{{image.id}}" role="tab" data-bs-toggle="tab" data-bs-target="#tab{{image.id}}"><img class="img-fluid" src="{{image.image.url}}" alt="" width="50"></a>
                                                </li>
                                            {% endfor %}
                                            {% for image in product_image %}
                                                <li role="presentation">
                                                    <a href="#tab{{image.id}}" role="tab" data-bs-toggle="tab" data-bs-target="#tab{{image.id}}"><img class="img-fluid" src="{{image.image.url}}" alt="" width="50"></a>
                                                </li>
                                            {% endfor %}
                                            {% for image in product_image %}
                                                <li role="presentation">
                                                    <a href="#tab{{image.id}}" role="tab" data-bs-toggle="tab" data-bs-target="#tab{{image.id}}"><img class="img-fluid" src="{{image.image.url}}" alt="" width="50"></a>
                                                </li>
                                            {% endfor %}
                                            {% for image in product_image %}
                                                <li role="presentation">
                                                    <a href="#tab{{image.id}}" role="tab" data-bs-toggle="tab" data-bs-target="#tab{{image.id}}"><img class="img-fluid" src="{{image.image.url}}" alt="" width="50"></a>
                                                </li>
                                            {% endfor %}
                                            
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab panes -->
                            
                            
                        </div>
                        <!--Tab slider End-->
                        <div class="col-xl-6 col-lg-6 col-xxl-6 col-12">
                            <div class="product-detail-content">
                                <!--Product details-->
                                <div class="new-arrival-content pr">
                                    <h4>{{product.name}}</h4>
                                    <div class="comment-review star-rating">
                                        <ul>
                                            <li><i class="fa fa-star {% if avg_rating >= 1 %}rating_active{% endif %}"></i></li>
                                            <li><i class="fa fa-star {% if avg_rating >= 2 %}rating_active{% endif %}"></i></li>
                                            <li><i class="fa fa-star {% if avg_rating >= 3 %}rating_active{% endif %}"></i></li>
                                            <li><i class="fa fa-star {% if avg_rating >= 4 %}rating_active{% endif %}"></i></li>
                                            <li><i class="fa fa-star {% if avg_rating >= 5 %}rating_active{% endif %}"></i></li>

                                        </ul>
                                        <span class="review-text">({{reviews.count}} reviews) </span>
                                    <div class="d-table mb-2">
                                        <p class="price float-start d-block">${{product.price}}</p>
                                    </div>
                                    <p>Availability: 
                                        {% if product.quantity > 0 %}
                                        <span class="item"> In stock <i class="fa fa-shopping-basket"></i></span>
                                        {% else %}
                                        <span class="item"> out stock</span>
                                        {% endif %}

                                    </p>
                                    <p>Brand: <span class="item">{{product.brand.name}}</span></p>
                                    
                                    <p class="text-content">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable.
                                        If you are going to use a passage of Lorem Ipsum, you need to be sure there isn't anything embarrassing.</p>
                                    <form action="{% url 'client:product_add_card' %}" method="post">
                                        {% csrf_token %}
                                        <div class="d-flex align-items-end flex-wrap mt-4">
                                                <!--Quantity start-->
                                                <input type="number" name="product_id" class="form-control input-btn input-number" hidden value="{{product.id}}">
                                                <div class="col-2 px-0  mb-2 me-3">
                                                    <input type="number" name="quantity" class="form-control input-btn input-number" value="1">
                                                </div>
                                                <!--Quanatity End-->
                                                <div class="shopping-cart  mb-2 me-3">
                                                    <button class="btn btn-primary" type="submit"><i class="fa fa-shopping-basket me-2"></i>Add
                                                        to cart</button>
                                                </div>
                                        
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-5">
        <div class="col-lg-9 col-12">
            
            <div class="button-groups">
                <a href="#description">Descriptions</a>
                <a href="#question">Questions</a>
                <a href="#review">Review</a>
            </div>
            
            <div class="description" id="description">
                <div class="card">
                    <div class="card-body">
                        <div>
                            <h2>Descriptions</h2>
                        </div>
                        <div class="full-description">
                            <h2 style="font-size: 20px;font-weight: 700;">{{product.name}}</h2>
                            <p style="text-align: justify;">{{product.discreption}}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="question" id="question">
                <div class="card">
                    <div class="card-body">
                        <div>
                            <h2>Questions & Answer ({{questions.count}})</h2>
                        </div>
                        <div class="full-description">
                            {% for question in questions %}
                                <div class="d-flex align-items-center oy-2" style="column-gap:10px;border-bottom: 1px solid gainsboro;">
                                    <div>Q: </div>
                                    <div>
                                        <div>{{question.question}}</div>
                                        <div>by <span style="color:#a97414">{{question.user.username}}</span></div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        <div class="question-add py-4">
                            <h2 style="font-size: 20px;font-weight: 700;">Your Question</h2>
                            <div class="question-form">
                                <div class="mb-3">
                                    <textarea class="form-control" placeholder="Question" id="question_text" style="height: 150px;"></textarea>
                                </div>
                                {% if user.is_authenticated %}
                                <button class="btn btn-success btn-block" id="send_question">QUESTION</button>
                                {% else %}
                                <a href="{% url 'client:login_view' %}" class="btn btn-success btn-block">QUESTION</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="review" id="review">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="review-header d-flex">
                            <div class="review-header-left">
                                <h2>Reviews ({{reviews.count}})</h2>
                                <p>Get specific details about this product from customers who own it.</p>
                                <div class="average-rating">
                                    <div class="rating-icon">
                                        <i class="fas fa-star {% if avg_rating >= 1 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if avg_rating >= 2 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if avg_rating >= 3 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if avg_rating >= 4 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if avg_rating >= 5 %}rating_active{% endif %}"></i>
                                    </div>
                                    <div class="rating-value">{{avg_rating}} out of 5</div>
                                </div>
                            </div>
                            <div class="review-header-right">
                                {% if user.is_authenticated %}
                                <button class="btn btn-outline-primary" type="button" data-bs-toggle="modal" data-bs-target="#reviewModal">Write a Review</button>
                                {% else %}
                                <a class="btn btn-outline-primary" href="{% url 'client:login_view' %}" >Write a Review</a>
                                {% endif %}
                                
                            </div>
                

                        </div>
                        <div class="all-review">
                            {% for review in reviews %}
                                <div class="review-card">
                                    <div class="rating-icon">
                                        <i class="fas fa-star {% if review.review_number >= 1 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if review.review_number >= 2 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if review.review_number >= 3 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if review.review_number >= 4 %}rating_active{% endif %}"></i>
                                        <i class="fas fa-star {% if review.review_number >= 5 %}rating_active{% endif %}"></i>
                                    </div>
                                    <p class="mb-1">{{review.review_text}}</p>
                                    <p class="m-0">By <span style="color: #d58b05;">{{review.user.username}}</span> on {{review.created_at|date:"d M Y"}}</p>
                                </div>
                            {% endfor %}
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-12">
            <div>
                <div class="card">
                    <div class="card-body">
                        <h2>Related Produdcts</h2>
                    </div>
                </div>
            </div>
            

        </div>
    </div>
    <!-- review -->
    <div class="modal fade" id="reviewModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Review</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal">
                    </button>
                </div>
                <div class="modal-body">
                        <div class="mb-3">
                            <div class="rating-widget mb-4 text-center">
                                <!-- Rating Stars Box -->
                                <div class="rating-stars">
                                    <ul id="stars" class="d-flex justify-content-center">
                                        <li class="star" title="Poor" data-value="1">
                                            <i class="fa fa-star fa-fw"></i>
                                        </li>
                                        <li class="star" title="Fair" data-value="2">
                                            <i class="fa fa-star fa-fw"></i>
                                        </li>
                                        <li class="star" title="Good" data-value="3">
                                            <i class="fa fa-star fa-fw"></i>
                                        </li>
                                        <li class="star" title="Excellent" data-value="4">
                                            <i class="fa fa-star fa-fw"></i>
                                        </li>
                                        <li class="star" title="WOW!!!" data-value="5">
                                            <i class="fa fa-star fa-fw"></i>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <textarea class="form-control" placeholder="Comment" id="review_text" rows="5"></textarea>
                        </div>
                        <button class="btn btn-success btn-block" id="send_review">REVIEW</button>
                    
                </div>
            </div>
        </div>
    </div>

{% endblock userbody %}

{% block userScript %}
<script>
    var review_rate = document.querySelectorAll('.star');
    var rate = 0;
    review_rate.forEach((rating,index1)=>{
        rating.addEventListener('click',()=>{
            
            rate = index1+1
            console.log(rate);
            review_rate.forEach((rating,index2)=>{
                index1 >= index2 ? rating.classList.add('rating_active') : rating.classList.remove('rating_active')
            })
        })
    });
    $('#send_review').on('click',()=>{
        var comment = $('#review_text').val();
        var rating = rate;
        var check = 1;
        if(!comment){
           check = 0;
           alert('Please add comment');
        }
        if(rating == 0){
            check = 0;
            alert('Please add product rating');
        }
        if(check == 1){
            $.ajax({
                type:'POST',
                url : "{% url 'product_info:product_rating' product.id %}",
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data:{
                    comment:comment,
                    rate:rating
                },success:(res)=>{
                    if(res['status'] =='success'){
                        location.reload()
                    }
                }

            })
        }
    })
    $('#send_question').on('click',()=>{
        var question = $('#question_text').val()
        if(question !=''){
            $.ajax({
                type:'POST',
                url:"{% url 'product_info:product_question' product.id %}",
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data:{
                    question:question
                },success:(res)=>{
                    console.log(res)
                    if(res['status'] == 'success'){
                        location.reload()
                    }
                }
            })
        }else{
            alert('Please add your question')
        }
    })

</script>

{% endblock userScript %}
